!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/highlight",e):t.highlight=e()}(this,function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){for(var n in e)t[n]=1;return t}function r(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n)}function o(t){t.parentNode.removeChild(t)}function s(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function c(t,e,n,r){t.addEventListener(e,n,r)}function h(t,e,n,r){t.removeEventListener(e,n,r)}function l(t,e){t.data=""+e}function f(t,e,n){t.style.setProperty(e,n)}function d(t,e){for(var n=0;n<t.options.length;n+=1){var r=t.options[n];if(r.__value===e)return void(r.selected=!0)}}function g(){return Object.create(null)}function p(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function v(t,e){return t!=t?e==e:t!==e}function _(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var i=n[r];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}}function m(t){t._lock=!0,k(t._beforecreate),k(t._oncreate),k(t._aftercreate),t._lock=!1}function y(){return this._state}function b(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function k(t){for(;t&&t.length;)t.shift()()}function w(){this.store._remove(this)}var E={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:y,fire:_,on:b,set:function(t){this._set(e({},t)),this.root._lock||m(this.root)},_recompute:t,_set:function(t){var n=this._state,r={},i=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(r[o]=i=!0);i&&(this._state=e(e({},n),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:p};function N(t,e){var n=arguments;if(void 0===e&&(e="core"),t=t.trim(),!dw.backend.__messages[e])return"MISSING:"+t;var r=dw.backend.__messages[e][t]||dw.backend.__messages.core[t]||t;if(arguments.length>2)for(var i=2;i<arguments.length;i++){var o=i-1;r=r.replace("$"+o,n[i])}return r}function O(t){var e=typeof t;return"function"===e||"object"===e&&!!t}var j,x=Array.prototype,S=Object.prototype,C=x.slice,P=S.toString,$=S.hasOwnProperty,M=Object.keys;function L(t,e){return null!=t&&$.call(t,e)}function A(t){if(!O(t))return[];if(M)return M(t);var e=[];for(var n in t)L(t,n)&&e.push(n);return Y&&function(t,e){var n=Z.length,r=t.constructor,i=T(r)&&r.prototype||S,o="constructor";L(t,o)&&!J(e,o)&&e.push(o);for(;n--;)(o=Z[n])in t&&t[o]!==i[o]&&!J(e,o)&&e.push(o)}(t,e),e}var I=function(t,e,n){return function(r,i,o){var s=0,a=W(r);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(r,i),r[o]===i?o:-1;if(i!=i)return(o=e(C.call(r,s,a),H))>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(r[o]===i)return o;return-1}}(1,(j=1,function(t,e,n){e=R(e,n);for(var r=W(t),i=j>0?0:r-1;i>=0&&i<r;i+=j)if(e(t[i],i,t))return i;return-1}),function(t,e,n,r){for(var i=(n=R(n,r,1))(e),o=0,s=W(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<i?o=a+1:s=a}return o});function J(t,e,n,r){return X(t)||(t=function(t){for(var e=A(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}(t)),("number"!=typeof n||r)&&(n=0),I(t,e,n)>=0}var T=("function"!=typeof/./&&"object"!=typeof Int8Array&&"undefined"!=typeof document&&"function"!=typeof document.childNodes?function(t){return"function"==typeof t||!1}:null)||function(t){return"[object Function]"===P.call(t)};!function(){P.call(arguments)}();function H(t){return function(t){return"[object Number]"===P.call(t)}(t)&&isNaN(t)}var q=Q;function z(t){return t}var B,F,G=(B=A,function(t){var e=arguments,n=arguments.length;if(F&&(t=Object(t)),n<2||null==t)return t;for(var r=1;r<n;r++)for(var i=e[r],o=B(i),s=o.length,a=0;a<s;a++){var u=o[a];!O(t)||F&&void 0!==t[u]||(t[u]=i[u])}return t});function D(t){return t=G({},t),function(e){return function(t,e){var n=A(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0}(e,t)}}function K(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}}function Q(t,e){return R(t,e,1/0)}function R(t,e,n){return q!==Q?q(t,e):null==t?z:T(t)?K(t,e,n):O(t)?D(t):U(t)}function U(t){return function(e){return null==e?void 0:e[t]}}var V=Math.pow(2,53)-1,W=U("length"),X=function(t){var e=W(t);return"number"==typeof e&&e>=0&&e<=V};var Y=!{toString:null}.propertyIsEnumerable("toString"),Z=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];!function(t){for(var e={},n=A(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r]}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"});var tt,et,nt=(tt=function(t,e,n){t[n]=e},function(t,e,n){var r=et?[[],[]]:{};return e=R(e,n),function(t,e,n){var r,i;if(e=K(e,n),X(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=A(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}}(t,function(n,i){var o=e(n,i,t);tt(r,n,o)}),r});var rt={add:function(t){var e=this,n=st(this.get().highlighted);n.indexOf(t)<0&&n.push(t),this.set({highlighted:n}),setTimeout(function(){return e.set({selected:"---"})},30)},remove:function(t){var e=this.get().highlighted;e.splice(e.indexOf(t),1),this.set({highlighted:e})}};function it(t){var e=t.current,n=t.changed;t.previous;n.selected&&e.selected&&"---"!==e.selected&&this.add(e.selected)}function ot(t){var e=t.current;if(t.changed.highlighted&&e.$vis){var n=e.$vis;JSON.stringify(n.get("highlighted-series"))!==JSON.stringify(e.highlighted)&&n&&n.chart().set("metadata.visualize.highlighted-series",st(e.highlighted))}}function st(t){return JSON.parse(JSON.stringify(t))}function at(t){var e=this._svelte,n=e.component,r=e.ctx;n.remove(r.el.key)}function ut(t,e,n){var r=Object.create(t);return r.el=e[n],r}function ct(t,e,n){var r=Object.create(t);return r.element=e[n],r}function ht(t,e){var n,s,c,h=e.element.label;return{c:function(){n=a("option"),s=u(h),n.__value=c=e.element.key,n.value=n.__value},m:function(t,e){i(t,n,e),r(n,s)},p:function(t,e){t.elements&&h!==(h=e.element.label)&&l(s,h),t.elements&&c!==(c=e.element.key)&&(n.__value=c),n.value=n.__value},d:function(t){t&&o(n)}}}function lt(t,e){var n,s,f,d,g,p,v,_=e.el.key;return{c:function(){n=a("span"),s=a("i"),f=u(" "),d=u(_),v=u("\n        Â "),s._svelte={component:t,ctx:e},c(s,"click",at),s.className="fa fa-remove",n.dataset.series=g=e.el.key,n.className=p="badge "+(e.el.valid?"badge-info":"")},m:function(t,e){i(t,n,e),r(n,s),r(n,f),r(n,d),i(t,v,e)},p:function(t,r){e=r,s._svelte.ctx=e,t.highlightedElements&&_!==(_=e.el.key)&&l(d,_),t.highlightedElements&&g!==(g=e.el.key)&&(n.dataset.series=g),t.highlightedElements&&p!==(p="badge "+(e.el.valid?"badge-info":""))&&(n.className=p)},d:function(t){t&&o(n),h(s,"click",at),t&&o(v)}}}function ft(t){var l=this;!function(t,e){t._handlers=g(),t._slots=g(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}(this,t),this._state=e(e(this.store._init(["vis"]),{selected:"---",highlighted:[]}),t.data),this.store._add(this,["vis"]),this._recompute({$vis:1,highlighted:1,elements:1},this._state),this._intro=!0,this._handlers.state=[it],this._handlers.update=[ot],this._handlers.destroy=[w],it.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){for(var n,l,g,p,v,_,m,y,b,k,w,E,O=N("Highlight the most import elements (optional)"),j=N("select element"),x=!1,S=e.elements,C=[],P=0;P<S.length;P+=1)C[P]=ht(0,ct(e,S,P));function $(){x=!0,t.set({selected:function(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(v)}),x=!1}var M=e.highlightedElements,L=[];for(P=0;P<M.length;P+=1)L[P]=lt(t,ut(e,M,P));return{c:function(){n=a("div"),l=a("label"),g=u("\n    "),p=a("div"),v=a("select"),_=a("option"),m=u("- "),y=a("noscript"),b=a("noscript"),k=u(" -");for(var r=0;r<C.length;r+=1)C[r].c();for(w=u("\n    "),E=a("p"),r=0;r<L.length;r+=1)L[r].c();l.className="separator",_.__value="---",_.value=_.__value,c(v,"change",$),"selected"in e||t.root._beforecreate.push($),v.id="highlight-series",v.className="span2",E.className="highlighted-series",f(E,"margin-top","5px"),n.className="story-highlight control-group",f(n,"clear","both")},m:function(t,o){i(t,n,o),r(n,l),l.innerHTML=O,r(n,g),r(n,p),r(p,v),r(v,_),r(_,m),r(_,y),y.insertAdjacentHTML("afterend",j),r(_,b),r(_,k);for(var s=0;s<C.length;s+=1)C[s].m(v,null);for(d(v,e.selected),r(n,w),r(n,E),s=0;s<L.length;s+=1)L[s].m(E,null)},p:function(e,n){if(e.elements){S=n.elements;for(var r=0;r<S.length;r+=1){var i=ct(n,S,r);C[r]?C[r].p(e,i):(C[r]=ht(0,i),C[r].c(),C[r].m(v,null))}for(;r<C.length;r+=1)C[r].d(1);C.length=S.length}if(!x&&e.selected&&d(v,n.selected),e.highlightedElements){for(M=n.highlightedElements,r=0;r<M.length;r+=1){var o=ut(n,M,r);L[r]?L[r].p(e,o):(L[r]=lt(t,o),L[r].c(),L[r].m(E,null))}for(;r<L.length;r+=1)L[r].d(1);L.length=M.length}},d:function(t){t&&o(n),s(C,t),h(v,"change",$),s(L,t)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this;this.store.on("state",function(e){var n=e.current,r=e.changed;if(e.previous,r.vis&&n.vis){var i=n.vis;t.set({highlighted:st(i.get("highlighted-series"))}),i.chart().onChange(function(e,n){"metadata.visualize.highlighted-series"===n&&t.set({highlighted:st(i.get("highlighted-series"))})})}})}).call(l),l.fire("update",{changed:n({},l._state),current:l._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this))}function dt(t,n){this._handlers={},this._dependents=[],this._computed=g(),this._sortedComputedProperties=[],this._state=e({},t),this._differs=n&&n.immutable?v:p}e(ft.prototype,E),e(ft.prototype,rt),ft.prototype._recompute=function(t,e){var n;t.$vis&&this._differs(e.elements,e.elements=(n=e.$vis)?n.keys().sort().map(function(t){var e=n.keyLabel(t);return{key:t,label:t+(t!==e?" ("+e+")":"")}}):[])&&(t.elements=!0),(t.highlighted||t.elements)&&this._differs(e.highlightedElements,e.highlightedElements=function(t){var e=t.highlighted,n=t.elements,r=nt(n,"key");return e.map(function(t){return{key:t,valid:r[t]}})}(e))&&(t.highlightedElements=!0)},e(dt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var r=t[n];e["$"+r]=this._state[r]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,n){var r=this,i=this._state;this._state=e(e({},i),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)r._sortedComputedProperties[o].update(r._state,n);this.fire("state",{changed:n,previous:i,current:this._state}),this._dependents.filter(function(t){for(var e={},i=!1,o=0;o<t.props.length;o+=1){var s=t.props[o];s in n&&(e["$"+s]=r._state[s],i=!0)}if(i)return t.component._stage(e),!0}).forEach(function(t){t.component.set({})}),this.fire("update",{changed:n,previous:i,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],r=g();function i(o){var s=e[o];s&&(s.deps.forEach(function(e){if(e===t)throw new Error("Cyclical dependency detected between "+e+" <-> "+o);i(e)}),r[o]||(r[o]=!0,n.push(s)))}for(var o in this._computed)i(t=o)},compute:function(t,n,r){var i,o=this,s={deps:n,update:function(e,s,a){var u=n.map(function(t){return t in s&&(a=!0),e[t]});if(a){var c=r.apply(null,u);o._differs(c,i)&&(i=c,s[t]=!0,e[t]=i)}}};this._computed[t]=s,this._sortComputedProperties();var a=e({},this._state),u={};s.update(a,u,!0),this._set(a,u)},fire:_,get:y,on:b,set:function(t){var e=this._state,n=this._changed={},r=!1;for(var i in t){if(this._computed[i])throw new Error("'"+i+"' is a read-only computed property");this._differs(t[i],e[i])&&(n[i]=r=!0)}r&&this._set(t,n)}});return{App:ft,data:{chart:{id:""}},store:new dt({}),init:function(t){window.dw.backend.on("dataset-loaded",function(){t.store.set({dataset:chart.dataset()})}).on("theme-changed-and-loaded",function(){t.store.set({theme:window.dw.theme(chart.get("theme"))})}).on("backend-vis-loaded",function(e){t.store.set({vis:e})})}}});
